var In=Object.defineProperty;var Ln=(e,t,n)=>t in e?In(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var S=(e,t,n)=>(Ln(e,typeof t!="symbol"?t+"":t,n),n);import{h as Z,at as Ie,ac as En,j as at,ab as lt,G as Pn,y as ze,ag as An,_ as Yt,o as C,c as I,k as B,d as Y,t as De,C as Jt,N as me,g as W,F as V,E as q,n as N,O as G,m as $,b as Q,J as oe,e as ge,$ as Qt,a as Rn,I as zn,r as On,X as Mn}from"./framework.DeQ1eoAg.js";const dt=e=>{const t=Z(null);return at(()=>{e.resizeObserver&&t.value&&e.resizeObserver.observe(t.value)}),lt(()=>{e.resizeObserver&&t.value&&e.resizeObserver.unobserve(t.value)}),{itemRefEl:t}},kn={fixed:!1,buffer:0,bufferTop:0,bufferBottom:0,scrollDistance:0,horizontal:!1,start:0,offset:0,listStyle:"",listClass:"",itemStyle:"",itemClass:"",headerClass:"",headerStyle:"",footerClass:"",footerStyle:"",stickyHeaderClass:"",stickyHeaderStyle:"",stickyFooterClass:"",stickyFooterStyle:""};function jn(e,t){const n=new Proxy(e,{get(_,T){var E;return(E=Reflect.get(_,T))!=null?E:Reflect.get(kn,T)}}),r=Z(null),i=Z(null),o=Z(null),s=Z(null),l=Z(null),a=Z(null),f=new Map,w=Z(0);let d="backward",y=!1,m=!1;const p=Ie({clientSize:0,headerSize:0,footerSize:0,stickyHeaderSize:0,stickyFooterSize:0}),g=Ie({views:0,offset:0,listTotalSize:0,virtualSize:0,inViewBegin:0,inViewEnd:0,renderBegin:0,renderEnd:0,bufferTop:0,bufferBottom:0});function v(){const _=n.horizontal?"scrollLeft":"scrollTop";return r.value?r.value[_]:0}function u(){return p.headerSize+p.footerSize+p.stickyHeaderSize+p.stickyFooterSize}function c(){return g.listTotalSize+p.headerSize+p.footerSize+p.stickyHeaderSize+p.stickyFooterSize}function h(_){var T;return n.fixed?n.minSize:(T=f.get(String(_)))!=null?T:n.minSize}function x(_,T){f.set(String(_),T)}function b(_){f.delete(String(_))}function M(_){var T,E;if(n.fixed)return{top:n.minSize*_,current:n.minSize,bottom:n.minSize*(_+1)};const{itemKey:P}=n;let R=p.headerSize;for(let O=0;O<=_-1;O+=1){const X=h((T=n.list[O])==null?void 0:T[P]);R+=X}const U=h((E=n.list[_])==null?void 0:E[P]);return{top:R,current:U,bottom:R+U}}function L(_,T=!1){T&&(m=!0);const E=n.horizontal?"scrollLeft":"scrollTop";r.value&&(r.value[E]=_)}async function K(_){if(console.log("scrollToIndex",_),_<0)return;if(_>=n.list.length-1){le();return}let{top:T}=M(_);const E=async()=>{L(T),setTimeout(()=>{const{top:P}=M(_);T!==P&&(T=P,E())},3)};E()}async function re(_){var T;const{top:E,bottom:P}=M(_),R=v(),U=v()+p.clientSize,O=h((T=n.list[_])==null?void 0:T[n.itemKey]);if(E<R&&R<P&&O<p.clientSize){L(E);return}if(E+p.stickyHeaderSize<U&&U<P+p.stickyHeaderSize&&O<p.clientSize){L(P-p.clientSize+p.stickyHeaderSize);return}if(E+p.stickyHeaderSize>=U){K(_);return}if(P<=R){K(_);return}}async function ee(){L(0),setTimeout(()=>{var _;const T=n.horizontal?"scrollLeft":"scrollTop";((_=r==null?void 0:r.value)==null?void 0:_[T])!==0&&ee()},3)}async function le(){L(c()),setTimeout(()=>{Math.abs(Math.round(g.offset+p.clientSize)-Math.round(c()))>2&&le()},0)}function H(_){g.inViewBegin=_,g.inViewEnd=Math.min(_+g.views,n.list.length-1)}function z(){var _,T;const{views:E,offset:P,inViewBegin:R}=g,{itemKey:U}=n,O=P-p.headerSize;let X=R,ce=Tn();if(O<0){H(0);return}if(d==="forward"){if(O>=ce)return;for(let ie=X-1;ie>=0;ie-=1){const $e=h((_=n.list[ie])==null?void 0:_[U]);if(ce-=$e,ce<=O&&O<ce+$e){X=ie;break}}y=!0}if(d==="backward"){if(O<=ce)return;for(let ie=X;ie<=n.list.length-1;ie+=1){const $e=h((T=n.list[ie])==null?void 0:T[U]);if(ce<=O&&O<ce+$e){X=ie;break}ce+=$e}y=!1}X!==g.inViewBegin&&H(X)}function D(_){var T,E,P;(T=t==null?void 0:t.scroll)==null||T.call(t,_);const R=v();R!==g.offset&&(d=R<g.offset?"forward":"backward",g.offset=R,z(),d==="forward"&&g.offset-n.scrollDistance<=0&&(console.log("[VirtList] 到达顶部"),(E=t==null?void 0:t.toTop)==null||E.call(t,n.list[0])),d==="backward"&&g.offset+n.scrollDistance>=g.listTotalSize+u()-p.clientSize&&(console.log("[VirtList] 到达底部"),(P=t==null?void 0:t.toBottom)==null||P.call(t,n.list[n.list.length-1])))}function A(){const _=Math.ceil(p.clientSize/n.minSize)+1;g.views=_}function J(){A(),H(g.inViewBegin)}function he(){var _;if(n.fixed){g.listTotalSize=n.minSize*n.list.length;return}const{itemKey:T}=n;let E=0;for(let P=0;P<=n.list.length-1;P+=1)E+=h((_=n.list[P])==null?void 0:_[T]);g.listTotalSize=E}function Se(){console.log("[VirtList] reset"),g.offset=0,g.listTotalSize=0,g.virtualSize=0,g.inViewBegin=0,g.inViewEnd=0,g.renderBegin=0,g.renderEnd=0,f.clear()}function de(_){he();let T=0;_.forEach(E=>{T+=h(E[n.itemKey])}),mt(),L(g.offset-T,!0),z()}function We(_){he();let T=0;_.forEach(E=>{T+=h(E[n.itemKey])}),mt(),L(g.offset+T,!0),z()}function wt(){w.value+=1}let F;typeof ResizeObserver<"u"&&(F=new ResizeObserver(_=>{var T;let E=0;for(const P of _){const R=P.target.dataset.id;if(R){const U=h(R);let O=0;if(P.borderBoxSize){const X=Array.isArray(P.contentBoxSize)?P.contentBoxSize[0]:P.contentBoxSize;O=n.horizontal?X.inlineSize:X.blockSize}else O=n.horizontal?P.contentRect.width:P.contentRect.height;R==="client"?(p.clientSize=O,J()):R==="header"?p.headerSize=O:R==="footer"?p.footerSize=O:R==="stickyHeader"?p.stickyHeaderSize=O:R==="stickyFooter"?p.stickyFooterSize=O:U!==O&&(x(R,O),E+=O-U,(T=t==null?void 0:t.itemResize)==null||T.call(t,R,O))}}g.listTotalSize+=E,(y||m)&&E!==0&&(y=!1,m=!1,L(g.offset+E))}));const mt=()=>{var _;let T=0;const E=g.inViewBegin;for(let P=0;P<E;P++)T+=h((_=n.list[P])==null?void 0:_[n.itemKey]);g.virtualSize=T};En(()=>{n.bufferTop?g.bufferTop=n.bufferTop:g.bufferTop=n.buffer,n.bufferBottom?g.bufferBottom=n.bufferBottom:g.bufferBottom=n.buffer}),at(()=>{r.value&&(r.value.addEventListener("scroll",D),F==null||F.observe(r.value)),l.value&&(F==null||F.observe(l.value)),a.value&&(F==null||F.observe(a.value)),o.value&&(F==null||F.observe(o.value)),s.value&&(F==null||F.observe(s.value)),n.start?K(n.start):n.offset&&L(n.offset)}),lt(()=>{r.value&&(r.value.removeEventListener("scroll",D),F==null||F.unobserve(r.value),p.clientSize=0),l.value&&(F==null||F.unobserve(l.value),p.stickyHeaderSize=0),a.value&&(F==null||F.unobserve(a.value),p.stickyFooterSize=0),o.value&&(F==null||F.unobserve(o.value),p.headerSize=0),s.value&&(F==null||F.unobserve(s.value),p.footerSize=0)});function Tn(){return g.virtualSize+Xe(g.renderBegin,g.inViewBegin)}function Xe(_,T){var E;const P=Math.min(_,T),R=Math.max(_,T);let U=0;for(let O=P;O<R;O+=1)U+=h((E=n.list[O])==null?void 0:E[n.itemKey]);return U}const yt=Pn([]);return ze(()=>[g.inViewBegin,g.inViewEnd,w.value],(_,T)=>{if(_&&T){const[E]=_,P=g.renderBegin;let R=E,U=g.inViewEnd;if(R=Math.max(0,R-g.bufferTop),U=Math.min(U+g.bufferBottom,n.list.length-1),n!=null&&n.renderControl){const{begin:O,end:X}=n.renderControl(E,g.inViewEnd);R=O,U=X}g.renderBegin=R,g.renderEnd=U,R>P?g.virtualSize+=Xe(R,P):g.virtualSize-=Xe(R,P),yt.value=n.list.slice(g.renderBegin,g.renderEnd+1)}},{immediate:!0}),ze(()=>n.list.length,()=>{if(n.list.length<=0){Se();return}he(),H(g.inViewBegin),wt()},{immediate:!0}),{props:n,renderList:yt,clientRefEl:r,listRefEl:i,headerRefEl:o,footerRefEl:s,stickyHeaderRefEl:l,stickyFooterRefEl:a,reactiveData:g,slotSize:p,sizesMap:f,resizeObserver:F,getOffset:v,reset:Se,scrollToIndex:K,scrollIntoView:re,scrollToTop:ee,scrollToBottom:le,scrollToOffset:L,getItemSize:h,deleteItemSize:b,deletedList2Top:de,addedList2Top:We,getItemPosByIndex:M,forceUpdate:wt}}var te=(e=>(e.Index="index",e.Title="title",e.Checkbox="checkbox",e.Expand="expand",e.Text="text",e))(te||{}),Le=(e=>(e.CellClick="cellClick",e.CellDblclick="cellDblclick",e.CellContextmenu="cellContextmenu",e))(Le||{}),Ee=(e=>(e.RowClick="rowClick",e.RowDblclick="rowDblclick",e.RowContextmenu="rowContextmenu",e))(Ee||{}),Pe=(e=>(e.HeaderClick="headerClick",e.HeaderDblclick="headerDblclick",e.HeaderContextmenu="headerContextmenu",e))(Pe||{}),Ue=(e=>(e.ExpandChange="expandChange",e.BoxSelection="boxSelection",e))(Ue||{});const Dn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Ae=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=Dn[n[e]&63];return t};const Bn=e=>{const t=[],n=[],r=[],i=[],o={};let s=0;function l({columns:m,level:p=0,parentId:g,parentColumn:v,fixed:u}){s=Math.max(s,p);let c=0,h=0;return m.forEach(x=>{var M;const b=x;if(b._id=b._id||`${b.field||""}-${Ae(4)}`,b.width=b.width??200,o[b._id]={...b},o[b._id].level=p,b.fixed===void 0&&u&&(b.fixed=u,o[b._id].fixed=u),v&&(v==null?void 0:v.fixed)===void 0&&(b.fixed=""),b.children&&((M=b.children)==null?void 0:M.length)>0){const L=l({columns:b.children,level:p+1,parentId:b._id,parentColumn:b,fixed:b.fixed});o[b._id].colspan=L,h+=L}else o[b._id].colspan=1,h+=1,o[b._id].isLeaf=!0,i.push(b),b.fixed==="left"?(o[b._id].left=c,c+=b.width,t.push(b)):b.fixed==="right"?n.push(b):r.push(b);g!==void 0&&(o[b._id].parentId=g),v!==void 0&&(o[b._id].parentColumn=v)}),h}l({columns:e});function a(m){const p=[],g=[],v=[],u=[...m];for(;u.length>0;){const c=[],h=[],x=[],b=u.length;for(let M=0;M<b;M++){const L=u.shift();o[L._id].rowspan=s-(o[L._id].level??0)+1,L.fixed==="left"?c.push(L):L.fixed==="right"?h.push(L):x.push(L),L.children&&(o[L._id].rowspan=1,u.push(...L.children))}p.push(c),g.push(h),v.push(x)}return{leftFixedHeaderColumns:p,rightFixedHeaderColumns:g,centerNormalHeaderColumns:v}}const{leftFixedHeaderColumns:f,rightFixedHeaderColumns:w,centerNormalHeaderColumns:d}=a(e);let y=0;for(let m=n.length-1;m>=0;m--)o[n[m]._id].right=y,y+=n[m].width;return i.forEach((m,p)=>{m.colIndex=p}),console.log("headerCellInfo",o),{headerCellInfo:o,flattedColumns:i,leftFixedColumns:t,rightFixedColumns:n,centerNormalColumns:r,originColumns:e,leftFixedHeaderColumns:f,rightFixedHeaderColumns:w,centerNormalHeaderColumns:d}};var en=typeof global=="object"&&global&&global.Object===Object&&global,Fn=typeof self=="object"&&self&&self.Object===Object&&self,ne=en||Fn||Function("return this")(),fe=ne.Symbol,tn=Object.prototype,Un=tn.hasOwnProperty,Nn=tn.toString,Te=fe?fe.toStringTag:void 0;function Hn(e){var t=Un.call(e,Te),n=e[Te];try{e[Te]=void 0;var r=!0}catch{}var i=Nn.call(e);return r&&(t?e[Te]=n:delete e[Te]),i}var Kn=Object.prototype,Gn=Kn.toString;function Zn(e){return Gn.call(e)}var Vn="[object Null]",Wn="[object Undefined]",bt=fe?fe.toStringTag:void 0;function Ce(e){return e==null?e===void 0?Wn:Vn:bt&&bt in Object(e)?Hn(e):Zn(e)}function ue(e){return e!=null&&typeof e=="object"}var Xn="[object Symbol]";function qn(e){return typeof e=="symbol"||ue(e)&&Ce(e)==Xn}var Oe=Array.isArray,Yn=/\s/;function Jn(e){for(var t=e.length;t--&&Yn.test(e.charAt(t)););return t}var Qn=/^\s+/;function er(e){return e&&e.slice(0,Jn(e)+1).replace(Qn,"")}function ve(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var xt=NaN,tr=/^[-+]0x[0-9a-f]+$/i,nr=/^0b[01]+$/i,rr=/^0o[0-7]+$/i,ir=parseInt;function qe(e){if(typeof e=="number")return e;if(qn(e))return xt;if(ve(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ve(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=er(e);var n=nr.test(e);return n||rr.test(e)?ir(e.slice(2),n?2:8):tr.test(e)?xt:+e}var or="[object AsyncFunction]",sr="[object Function]",ar="[object GeneratorFunction]",lr="[object Proxy]";function nn(e){if(!ve(e))return!1;var t=Ce(e);return t==sr||t==ar||t==or||t==lr}var Ye=ne["__core-js_shared__"],_t=function(){var e=/[^.]+$/.exec(Ye&&Ye.keys&&Ye.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function dr(e){return!!_t&&_t in e}var cr=Function.prototype,fr=cr.toString;function ye(e){if(e!=null){try{return fr.call(e)}catch{}try{return e+""}catch{}}return""}var ur=/[\\^$.*+?()[\]{}|]/g,hr=/^\[object .+?Constructor\]$/,pr=Function.prototype,gr=Object.prototype,vr=pr.toString,wr=gr.hasOwnProperty,mr=RegExp("^"+vr.call(wr).replace(ur,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function yr(e){if(!ve(e)||dr(e))return!1;var t=nn(e)?mr:hr;return t.test(ye(e))}function br(e,t){return e==null?void 0:e[t]}function be(e,t){var n=br(e,t);return yr(n)?n:void 0}var nt=be(ne,"WeakMap"),Ct=Object.create,xr=function(){function e(){}return function(t){if(!ve(t))return{};if(Ct)return Ct(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function _r(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var St=function(){try{var e=be(Object,"defineProperty");return e({},"",{}),e}catch{}}();function Cr(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}var Sr=9007199254740991,$r=/^(?:0|[1-9]\d*)$/;function Tr(e,t){var n=typeof e;return t=t??Sr,!!t&&(n=="number"||n!="symbol"&&$r.test(e))&&e>-1&&e%1==0&&e<t}function rn(e,t,n){t=="__proto__"&&St?St(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ct(e,t){return e===t||e!==e&&t!==t}var Ir=Object.prototype,Lr=Ir.hasOwnProperty;function on(e,t,n){var r=e[t];(!(Lr.call(e,t)&&ct(r,n))||n===void 0&&!(t in e))&&rn(e,t,n)}function Ge(e,t,n,r){var i=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var l=t[o],a=r?r(n[l],e[l],l,n,e):void 0;a===void 0&&(a=e[l]),i?rn(n,l,a):on(n,l,a)}return n}var Er=9007199254740991;function sn(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Er}function an(e){return e!=null&&sn(e.length)&&!nn(e)}var Pr=Object.prototype;function ft(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Pr;return e===n}function Ar(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var Rr="[object Arguments]";function $t(e){return ue(e)&&Ce(e)==Rr}var ln=Object.prototype,zr=ln.hasOwnProperty,Or=ln.propertyIsEnumerable,Mr=$t(function(){return arguments}())?$t:function(e){return ue(e)&&zr.call(e,"callee")&&!Or.call(e,"callee")};function kr(){return!1}var dn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Tt=dn&&typeof module=="object"&&module&&!module.nodeType&&module,jr=Tt&&Tt.exports===dn,It=jr?ne.Buffer:void 0,Dr=It?It.isBuffer:void 0,Ne=Dr||kr,Br="[object Arguments]",Fr="[object Array]",Ur="[object Boolean]",Nr="[object Date]",Hr="[object Error]",Kr="[object Function]",Gr="[object Map]",Zr="[object Number]",Vr="[object Object]",Wr="[object RegExp]",Xr="[object Set]",qr="[object String]",Yr="[object WeakMap]",Jr="[object ArrayBuffer]",Qr="[object DataView]",ei="[object Float32Array]",ti="[object Float64Array]",ni="[object Int8Array]",ri="[object Int16Array]",ii="[object Int32Array]",oi="[object Uint8Array]",si="[object Uint8ClampedArray]",ai="[object Uint16Array]",li="[object Uint32Array]",j={};j[ei]=j[ti]=j[ni]=j[ri]=j[ii]=j[oi]=j[si]=j[ai]=j[li]=!0;j[Br]=j[Fr]=j[Jr]=j[Ur]=j[Qr]=j[Nr]=j[Hr]=j[Kr]=j[Gr]=j[Zr]=j[Vr]=j[Wr]=j[Xr]=j[qr]=j[Yr]=!1;function di(e){return ue(e)&&sn(e.length)&&!!j[Ce(e)]}function ut(e){return function(t){return e(t)}}var cn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Re=cn&&typeof module=="object"&&module&&!module.nodeType&&module,ci=Re&&Re.exports===cn,Je=ci&&en.process,_e=function(){try{var e=Re&&Re.require&&Re.require("util").types;return e||Je&&Je.binding&&Je.binding("util")}catch{}}(),Lt=_e&&_e.isTypedArray,fn=Lt?ut(Lt):di,fi=Object.prototype,ui=fi.hasOwnProperty;function un(e,t){var n=Oe(e),r=!n&&Mr(e),i=!n&&!r&&Ne(e),o=!n&&!r&&!i&&fn(e),s=n||r||i||o,l=s?Ar(e.length,String):[],a=l.length;for(var f in e)(t||ui.call(e,f))&&!(s&&(f=="length"||i&&(f=="offset"||f=="parent")||o&&(f=="buffer"||f=="byteLength"||f=="byteOffset")||Tr(f,a)))&&l.push(f);return l}function hn(e,t){return function(n){return e(t(n))}}var hi=hn(Object.keys,Object),pi=Object.prototype,gi=pi.hasOwnProperty;function vi(e){if(!ft(e))return hi(e);var t=[];for(var n in Object(e))gi.call(e,n)&&n!="constructor"&&t.push(n);return t}function ht(e){return an(e)?un(e):vi(e)}function wi(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var mi=Object.prototype,yi=mi.hasOwnProperty;function bi(e){if(!ve(e))return wi(e);var t=ft(e),n=[];for(var r in e)r=="constructor"&&(t||!yi.call(e,r))||n.push(r);return n}function pt(e){return an(e)?un(e,!0):bi(e)}var Me=be(Object,"create");function xi(){this.__data__=Me?Me(null):{},this.size=0}function _i(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Ci="__lodash_hash_undefined__",Si=Object.prototype,$i=Si.hasOwnProperty;function Ti(e){var t=this.__data__;if(Me){var n=t[e];return n===Ci?void 0:n}return $i.call(t,e)?t[e]:void 0}var Ii=Object.prototype,Li=Ii.hasOwnProperty;function Ei(e){var t=this.__data__;return Me?t[e]!==void 0:Li.call(t,e)}var Pi="__lodash_hash_undefined__";function Ai(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Me&&t===void 0?Pi:t,this}function we(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}we.prototype.clear=xi;we.prototype.delete=_i;we.prototype.get=Ti;we.prototype.has=Ei;we.prototype.set=Ai;function Ri(){this.__data__=[],this.size=0}function Ze(e,t){for(var n=e.length;n--;)if(ct(e[n][0],t))return n;return-1}var zi=Array.prototype,Oi=zi.splice;function Mi(e){var t=this.__data__,n=Ze(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():Oi.call(t,n,1),--this.size,!0}function ki(e){var t=this.__data__,n=Ze(t,e);return n<0?void 0:t[n][1]}function ji(e){return Ze(this.__data__,e)>-1}function Di(e,t){var n=this.__data__,r=Ze(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function ae(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ae.prototype.clear=Ri;ae.prototype.delete=Mi;ae.prototype.get=ki;ae.prototype.has=ji;ae.prototype.set=Di;var ke=be(ne,"Map");function Bi(){this.size=0,this.__data__={hash:new we,map:new(ke||ae),string:new we}}function Fi(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Ve(e,t){var n=e.__data__;return Fi(t)?n[typeof t=="string"?"string":"hash"]:n.map}function Ui(e){var t=Ve(this,e).delete(e);return this.size-=t?1:0,t}function Ni(e){return Ve(this,e).get(e)}function Hi(e){return Ve(this,e).has(e)}function Ki(e,t){var n=Ve(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function xe(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}xe.prototype.clear=Bi;xe.prototype.delete=Ui;xe.prototype.get=Ni;xe.prototype.has=Hi;xe.prototype.set=Ki;function pn(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Gi=hn(Object.getPrototypeOf,Object);const gn=Gi;function Zi(e,t,n){return e===e&&(n!==void 0&&(e=e<=n?e:n),t!==void 0&&(e=e>=t?e:t)),e}function Vi(e,t,n){return n===void 0&&(n=t,t=void 0),n!==void 0&&(n=qe(n),n=n===n?n:0),t!==void 0&&(t=qe(t),t=t===t?t:0),Zi(qe(e),t,n)}function Wi(){this.__data__=new ae,this.size=0}function Xi(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function qi(e){return this.__data__.get(e)}function Yi(e){return this.__data__.has(e)}var Ji=200;function Qi(e,t){var n=this.__data__;if(n instanceof ae){var r=n.__data__;if(!ke||r.length<Ji-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new xe(r)}return n.set(e,t),this.size=n.size,this}function se(e){var t=this.__data__=new ae(e);this.size=t.size}se.prototype.clear=Wi;se.prototype.delete=Xi;se.prototype.get=qi;se.prototype.has=Yi;se.prototype.set=Qi;function eo(e,t){return e&&Ge(t,ht(t),e)}function to(e,t){return e&&Ge(t,pt(t),e)}var vn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Et=vn&&typeof module=="object"&&module&&!module.nodeType&&module,no=Et&&Et.exports===vn,Pt=no?ne.Buffer:void 0,At=Pt?Pt.allocUnsafe:void 0;function ro(e,t){if(t)return e.slice();var n=e.length,r=At?At(n):new e.constructor(n);return e.copy(r),r}function io(e,t){for(var n=-1,r=e==null?0:e.length,i=0,o=[];++n<r;){var s=e[n];t(s,n,e)&&(o[i++]=s)}return o}function wn(){return[]}var oo=Object.prototype,so=oo.propertyIsEnumerable,Rt=Object.getOwnPropertySymbols,gt=Rt?function(e){return e==null?[]:(e=Object(e),io(Rt(e),function(t){return so.call(e,t)}))}:wn;function ao(e,t){return Ge(e,gt(e),t)}var lo=Object.getOwnPropertySymbols,mn=lo?function(e){for(var t=[];e;)pn(t,gt(e)),e=gn(e);return t}:wn;function co(e,t){return Ge(e,mn(e),t)}function yn(e,t,n){var r=t(e);return Oe(e)?r:pn(r,n(e))}function rt(e){return yn(e,ht,gt)}function fo(e){return yn(e,pt,mn)}var it=be(ne,"DataView"),ot=be(ne,"Promise"),st=be(ne,"Set"),zt="[object Map]",uo="[object Object]",Ot="[object Promise]",Mt="[object Set]",kt="[object WeakMap]",jt="[object DataView]",ho=ye(it),po=ye(ke),go=ye(ot),vo=ye(st),wo=ye(nt),pe=Ce;(it&&pe(new it(new ArrayBuffer(1)))!=jt||ke&&pe(new ke)!=zt||ot&&pe(ot.resolve())!=Ot||st&&pe(new st)!=Mt||nt&&pe(new nt)!=kt)&&(pe=function(e){var t=Ce(e),n=t==uo?e.constructor:void 0,r=n?ye(n):"";if(r)switch(r){case ho:return jt;case po:return zt;case go:return Ot;case vo:return Mt;case wo:return kt}return t});const je=pe;var mo=Object.prototype,yo=mo.hasOwnProperty;function bo(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&yo.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var He=ne.Uint8Array;function vt(e){var t=new e.constructor(e.byteLength);return new He(t).set(new He(e)),t}function xo(e,t){var n=t?vt(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var _o=/\w*$/;function Co(e){var t=new e.constructor(e.source,_o.exec(e));return t.lastIndex=e.lastIndex,t}var Dt=fe?fe.prototype:void 0,Bt=Dt?Dt.valueOf:void 0;function So(e){return Bt?Object(Bt.call(e)):{}}function $o(e,t){var n=t?vt(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var To="[object Boolean]",Io="[object Date]",Lo="[object Map]",Eo="[object Number]",Po="[object RegExp]",Ao="[object Set]",Ro="[object String]",zo="[object Symbol]",Oo="[object ArrayBuffer]",Mo="[object DataView]",ko="[object Float32Array]",jo="[object Float64Array]",Do="[object Int8Array]",Bo="[object Int16Array]",Fo="[object Int32Array]",Uo="[object Uint8Array]",No="[object Uint8ClampedArray]",Ho="[object Uint16Array]",Ko="[object Uint32Array]";function Go(e,t,n){var r=e.constructor;switch(t){case Oo:return vt(e);case To:case Io:return new r(+e);case Mo:return xo(e,n);case ko:case jo:case Do:case Bo:case Fo:case Uo:case No:case Ho:case Ko:return $o(e,n);case Lo:return new r;case Eo:case Ro:return new r(e);case Po:return Co(e);case Ao:return new r;case zo:return So(e)}}function Zo(e){return typeof e.constructor=="function"&&!ft(e)?xr(gn(e)):{}}var Vo="[object Map]";function Wo(e){return ue(e)&&je(e)==Vo}var Ft=_e&&_e.isMap,Xo=Ft?ut(Ft):Wo,qo="[object Set]";function Yo(e){return ue(e)&&je(e)==qo}var Ut=_e&&_e.isSet,Jo=Ut?ut(Ut):Yo,Qo=1,es=2,ts=4,bn="[object Arguments]",ns="[object Array]",rs="[object Boolean]",is="[object Date]",os="[object Error]",xn="[object Function]",ss="[object GeneratorFunction]",as="[object Map]",ls="[object Number]",_n="[object Object]",ds="[object RegExp]",cs="[object Set]",fs="[object String]",us="[object Symbol]",hs="[object WeakMap]",ps="[object ArrayBuffer]",gs="[object DataView]",vs="[object Float32Array]",ws="[object Float64Array]",ms="[object Int8Array]",ys="[object Int16Array]",bs="[object Int32Array]",xs="[object Uint8Array]",_s="[object Uint8ClampedArray]",Cs="[object Uint16Array]",Ss="[object Uint32Array]",k={};k[bn]=k[ns]=k[ps]=k[gs]=k[rs]=k[is]=k[vs]=k[ws]=k[ms]=k[ys]=k[bs]=k[as]=k[ls]=k[_n]=k[ds]=k[cs]=k[fs]=k[us]=k[xs]=k[_s]=k[Cs]=k[Ss]=!0;k[os]=k[xn]=k[hs]=!1;function Fe(e,t,n,r,i,o){var s,l=t&Qo,a=t&es,f=t&ts;if(n&&(s=i?n(e,r,i,o):n(e)),s!==void 0)return s;if(!ve(e))return e;var w=Oe(e);if(w){if(s=bo(e),!l)return _r(e,s)}else{var d=je(e),y=d==xn||d==ss;if(Ne(e))return ro(e,l);if(d==_n||d==bn||y&&!i){if(s=a||y?{}:Zo(e),!l)return a?co(e,to(s,e)):ao(e,eo(s,e))}else{if(!k[d])return i?e:{};s=Go(e,d,l)}}o||(o=new se);var m=o.get(e);if(m)return m;o.set(e,s),Jo(e)?e.forEach(function(v){s.add(Fe(v,t,n,v,e,o))}):Xo(e)&&e.forEach(function(v,u){s.set(u,Fe(v,t,n,u,e,o))});var p=f?a?fo:rt:a?pt:ht,g=w?void 0:p(e);return Cr(g||e,function(v,u){g&&(u=v,v=e[u]),on(s,u,Fe(v,t,n,u,e,o))}),s}var $s=1,Ts=4;function Nt(e){return Fe(e,$s|Ts)}var Is="__lodash_hash_undefined__";function Ls(e){return this.__data__.set(e,Is),this}function Es(e){return this.__data__.has(e)}function Ke(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new xe;++t<n;)this.add(e[t])}Ke.prototype.add=Ke.prototype.push=Ls;Ke.prototype.has=Es;function Ps(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function As(e,t){return e.has(t)}var Rs=1,zs=2;function Cn(e,t,n,r,i,o){var s=n&Rs,l=e.length,a=t.length;if(l!=a&&!(s&&a>l))return!1;var f=o.get(e),w=o.get(t);if(f&&w)return f==t&&w==e;var d=-1,y=!0,m=n&zs?new Ke:void 0;for(o.set(e,t),o.set(t,e);++d<l;){var p=e[d],g=t[d];if(r)var v=s?r(g,p,d,t,e,o):r(p,g,d,e,t,o);if(v!==void 0){if(v)continue;y=!1;break}if(m){if(!Ps(t,function(u,c){if(!As(m,c)&&(p===u||i(p,u,n,r,o)))return m.push(c)})){y=!1;break}}else if(!(p===g||i(p,g,n,r,o))){y=!1;break}}return o.delete(e),o.delete(t),y}function Os(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Ms(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var ks=1,js=2,Ds="[object Boolean]",Bs="[object Date]",Fs="[object Error]",Us="[object Map]",Ns="[object Number]",Hs="[object RegExp]",Ks="[object Set]",Gs="[object String]",Zs="[object Symbol]",Vs="[object ArrayBuffer]",Ws="[object DataView]",Ht=fe?fe.prototype:void 0,Qe=Ht?Ht.valueOf:void 0;function Xs(e,t,n,r,i,o,s){switch(n){case Ws:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Vs:return!(e.byteLength!=t.byteLength||!o(new He(e),new He(t)));case Ds:case Bs:case Ns:return ct(+e,+t);case Fs:return e.name==t.name&&e.message==t.message;case Hs:case Gs:return e==t+"";case Us:var l=Os;case Ks:var a=r&ks;if(l||(l=Ms),e.size!=t.size&&!a)return!1;var f=s.get(e);if(f)return f==t;r|=js,s.set(e,t);var w=Cn(l(e),l(t),r,i,o,s);return s.delete(e),w;case Zs:if(Qe)return Qe.call(e)==Qe.call(t)}return!1}var qs=1,Ys=Object.prototype,Js=Ys.hasOwnProperty;function Qs(e,t,n,r,i,o){var s=n&qs,l=rt(e),a=l.length,f=rt(t),w=f.length;if(a!=w&&!s)return!1;for(var d=a;d--;){var y=l[d];if(!(s?y in t:Js.call(t,y)))return!1}var m=o.get(e),p=o.get(t);if(m&&p)return m==t&&p==e;var g=!0;o.set(e,t),o.set(t,e);for(var v=s;++d<a;){y=l[d];var u=e[y],c=t[y];if(r)var h=s?r(c,u,y,t,e,o):r(u,c,y,e,t,o);if(!(h===void 0?u===c||i(u,c,n,r,o):h)){g=!1;break}v||(v=y=="constructor")}if(g&&!v){var x=e.constructor,b=t.constructor;x!=b&&"constructor"in e&&"constructor"in t&&!(typeof x=="function"&&x instanceof x&&typeof b=="function"&&b instanceof b)&&(g=!1)}return o.delete(e),o.delete(t),g}var ea=1,Kt="[object Arguments]",Gt="[object Array]",Be="[object Object]",ta=Object.prototype,Zt=ta.hasOwnProperty;function na(e,t,n,r,i,o){var s=Oe(e),l=Oe(t),a=s?Gt:je(e),f=l?Gt:je(t);a=a==Kt?Be:a,f=f==Kt?Be:f;var w=a==Be,d=f==Be,y=a==f;if(y&&Ne(e)){if(!Ne(t))return!1;s=!0,w=!1}if(y&&!w)return o||(o=new se),s||fn(e)?Cn(e,t,n,r,i,o):Xs(e,t,a,n,r,i,o);if(!(n&ea)){var m=w&&Zt.call(e,"__wrapped__"),p=d&&Zt.call(t,"__wrapped__");if(m||p){var g=m?e.value():e,v=p?t.value():t;return o||(o=new se),i(g,v,n,r,o)}}return y?(o||(o=new se),Qs(e,t,n,r,i,o)):!1}function Sn(e,t,n,r,i){return e===t?!0:e==null||t==null||!ue(e)&&!ue(t)?e!==e&&t!==t:na(e,t,n,r,Sn,i)}function ra(e,t){return Sn(e,t)}const Vt=e=>{const t=e.composedPath().find(n=>{var r,i,o;return!((r=n.classList)!=null&&r.contains("kita-grid-cell--unselectable"))&&((i=n.dataset)==null?void 0:i.colidx)&&((o=n.dataset)==null?void 0:o.rowidx)});if(t&&t.dataset){const{colidx:n,rowidx:r,colspan:i,rowspan:o}=t.dataset;return{rowIndex:+(r||0),colIndex:+(n||0),rowspan:+(o||1),colspan:+(i||1)}}};class ia{constructor(t){S(this,"container");S(this,"boxArea",{left:0,top:0,right:0,bottom:0});S(this,"id","");S(this,"startPos",{rowIndex:-1,colIndex:-1});S(this,"lastClickPos");S(this,"lastShiftClickPos");S(this,"callbackFunc",()=>{});S(this,"isMetaKey",!1);S(this,"isShiftKey",!1);S(this,"preventContextMenu",t=>{t.preventDefault(),this.onMouseup()});S(this,"onMousedown",t=>{if(!this.store.getUIProps("selection")||t.buttons!==1||t.button)return;const n=Vt(t);if(this.isMetaKey=t.metaKey||t.ctrlKey,this.isShiftKey=t.shiftKey,n){const{colIndex:r,rowIndex:i}=n;if(this.id=Ae(4),this.startPos={rowIndex:i,colIndex:r},this.isShiftKey?this.lastShiftClickPos||(this.lastShiftClickPos=Nt(this.lastClickPos||this.startPos)):this.lastShiftClickPos=void 0,this.isShiftKey&&this.lastShiftClickPos){const{rowIndex:o,colIndex:s}=this.lastShiftClickPos;this.boxArea={top:Math.min(i,o),bottom:Math.max(i,o),left:Math.min(r,s),right:Math.max(r,s)}}else this.boxArea={top:i,bottom:i,left:r,right:r};this.lastClickPos=Nt(this.startPos),this.container.style.userSelect="none",document.body.addEventListener("mouseup",this.onMouseup),document.body.addEventListener("mouseover",this.onMouseOver),document.body.addEventListener("contextmenu",this.preventContextMenu),this.store.gridScrollZone.append(),this.emitChange()}});S(this,"onMouseOver",t=>{if(!this.store.getUIProps("selection"))return;const n=Vt(t);if(n){const{colIndex:r,rowIndex:i}=n,o={top:Math.min(this.startPos.rowIndex,i),bottom:Math.max(this.startPos.rowIndex,i),left:Math.min(this.startPos.colIndex,r),right:Math.max(this.startPos.colIndex,r)};ra(o,this.boxArea)||(this.boxArea=o,this.emitChange())}});S(this,"onMouseup",()=>{this.store.getUIProps("selection")&&(this.id="",this.boxArea={left:0,top:0,right:0,bottom:0},this.container.style.userSelect="auto",document.body.removeEventListener("mouseover",this.onMouseOver),document.body.removeEventListener("mouseup",this.onMouseup),document.body.removeEventListener("contextmenu",this.preventContextMenu),this.store.gridScrollZone.remove())});this.store=t}init(t){this.container=t,this.container.addEventListener("mousedown",this.onMousedown)}on(t){this.callbackFunc=t}reset(){}emitChange(){this.callbackFunc(this.id,this.boxArea,this.isMetaKey)}destroy(){var t;(t=this.container)==null||t.removeEventListener("mousedown",this.onMousedown),document.body.removeEventListener("contextmenu",this.preventContextMenu),document.body.removeEventListener("mouseup",this.onMouseup),document.body.removeEventListener("mouseover",this.onMouseOver),this.store.gridScrollZone.remove()}}const Wt=e=>({onExpandChange(t){e.eventEmitter.emit(Ue.ExpandChange,t)},onCellSelection(t){e.eventEmitter.emit(Ue.BoxSelection,t)}}),et=(e,t)=>{const r=e.composedPath().find(i=>{var o;return(o=i.classList)==null?void 0:o.contains("kita-grid-th")});if(r){const i=r.dataset.id;if(i===void 0)return;const o=t.headerCellInfo[i];return{event:e,column:o}}return null},tt=(e,t)=>{const r=e.composedPath().find(i=>{var o;return(o=i.classList)==null?void 0:o.contains("kita-grid-td")});if(r){const i=r.dataset.rowidx,o=r.dataset.colidx;if(i===void 0||o===void 0)return;const s=+i,l=+o,a=t.flattedColumns[l],f=t.originList[s];return a&&f?{event:e,column:a,columnIndex:l,row:t.originList[s],rowIndex:s,cell:a.field?f[a.field]:null}:null}},oa=e=>({onClick:i=>{const o=et(i,e);if(o){e.eventEmitter.emit(Pe.HeaderClick,o);return}const s=tt(i,e);s&&(e.eventEmitter.emit(Le.CellClick,s),e.eventEmitter.emit(Ee.RowClick,s))},onDblclick:i=>{const o=et(i,e);if(o){e.eventEmitter.emit(Pe.HeaderDblclick,o);return}const s=tt(i,e);s&&(e.eventEmitter.emit(Le.CellDblclick,s),e.eventEmitter.emit(Ee.RowDblclick,s))},onContextmenu:i=>{const o=et(i,e);if(o){e.eventEmitter.emit(Pe.HeaderContextmenu,o);return}const s=tt(i,e);s&&(e.eventEmitter.emit(Le.CellContextmenu,s),e.eventEmitter.emit(Ee.RowContextmenu,s))}});class sa{constructor(){S(this,"events",{})}on(t,n){this.events[t]||(this.events[t]=[]),this.events[t].push(n)}off(t,n){this.events[t]&&(this.events[t]=this.events[t].filter(r=>r!==n))}emit(t,...n){this.events[t]&&this.events[t].forEach(r=>r(...n))}once(t,n){const r=(...i)=>{n(...i),this.off(t,r)};this.on(t,r)}offAll(){this.events={}}}class aa{constructor(t){S(this,"container");S(this,"scrollUpZone");S(this,"scrollDownZone");S(this,"scrollIntervalTimer",0);S(this,"speed",4);S(this,"lastDirection",0);S(this,"handler",t=>{const n=document.elementsFromPoint(t.pageX,t.pageY);n.includes(this.scrollUpZone)?(this.onListScrollUp(),this.lastDirection=-1):n.includes(this.scrollDownZone)?(this.onListScrollDown(),this.lastDirection=1):(cancelAnimationFrame(this.scrollIntervalTimer),this.lastDirection=0)});this.store=t,this.scrollUpZone=document.createElement("div"),this.scrollUpZone.style.width="3000px",this.scrollUpZone.style.height="64px",this.scrollUpZone.style.position="absolute",this.scrollUpZone.style.left="0",this.scrollUpZone.style.top="0",this.scrollUpZone.style.background="transparent",this.scrollUpZone.style.zIndex="-100",this.scrollUpZone.id="kita-grid-scroll-zone__top",this.scrollDownZone=document.createElement("div"),this.scrollDownZone.style.width="3000px",this.scrollDownZone.style.height="40px",this.scrollDownZone.style.position="absolute",this.scrollDownZone.style.left="0",this.scrollDownZone.style.bottom="0",this.scrollDownZone.style.background="transparent",this.scrollDownZone.style.zIndex="-100",this.scrollUpZone.id="kita-grid-scroll-zone__bottom"}init(t){this.container=t}scrollUp(t,n=1){this.scrollIntervalTimer=requestAnimationFrame(()=>{var r;(r=this.store.virtualListRef)==null||r.scrollToOffset(t-this.speed*n),this.scrollUp(t,n+1)})}scrollDown(t,n=1){this.scrollIntervalTimer=requestAnimationFrame(()=>{var r;(r=this.store.virtualListRef)==null||r.scrollToOffset(t+this.speed*n),this.scrollDown(t,n+1)})}onListScrollUp(){cancelAnimationFrame(this.scrollIntervalTimer);const{offset:t}=this.store.virtualListRef.reactiveData,n=this.lastDirection===-1?2:1;this.scrollUp(t,n)}onListScrollDown(){cancelAnimationFrame(this.scrollIntervalTimer);const{offset:t}=this.store.virtualListRef.reactiveData,n=this.lastDirection===1?2:1;this.scrollDown(t,n)}append(){var t,n,r;this.remove(),(t=this.container)==null||t.appendChild(this.scrollUpZone),(n=this.container)==null||n.appendChild(this.scrollDownZone),(r=this.container)==null||r.addEventListener("mousemove",this.handler),document.body.addEventListener("mouseup",this.handler),this.lastDirection=0}remove(){var t,n,r;cancelAnimationFrame(this.scrollIntervalTimer),(t=this.scrollUpZone)==null||t.remove(),(n=this.scrollDownZone)==null||n.remove(),(r=this.container)==null||r.removeEventListener("mousemove",this.handler),document.body.removeEventListener("mouseup",this.handler),this.lastDirection=0}}class la{constructor(){S(this,"watchData",An({renderKey:0,colRenderBegin:0,colRenderEnd:0,rowHeightMap:new Map,foldMap:{},expandMap:{},config:{rowHeight:36,colWidth:100},fullWidth:0}));S(this,"rowKey","id");S(this,"virtualListProps",Ie({list:[],minSize:30,itemKey:this.rowKey,renderControl:(t,n)=>{var r,i,o,s;return{begin:((i=(r=this.bodyMergeMap)==null?void 0:r[t])==null?void 0:i.$begin)??t,end:((s=(o=this.bodyMergeMap)==null?void 0:o[n])==null?void 0:s.$end)??n}}}));S(this,"uiProps",Ie({border:!1,stripe:!1,showTreeLine:!1,selection:!1,highlightCurrentRow:!1,highlightCurrentColumn:!1,defaultExpandAll:!1,headerRowClassName:()=>"",headerRowStyle:()=>"",headerCellClassName:()=>"",headerCellStyle:()=>"",rowClassName:()=>"",rowStyle:()=>"",cellClassName:()=>"",cellStyle:()=>""}));S(this,"interaction",Ie({selectBoxes:{},selectCellBorderMap:{},selectCellClassMap:{}}));S(this,"originColumns",[]);S(this,"flattedColumns",[]);S(this,"leftFixedColumns",[]);S(this,"rightFixedColumns",[]);S(this,"centerNormalColumns",[]);S(this,"leftFixedHeaderColumns",[]);S(this,"rightFixedHeaderColumns",[]);S(this,"centerNormalHeaderColumns",[]);S(this,"originList",[]);S(this,"bodyMergeMap",{});S(this,"headerCellInfo",{});S(this,"gridSelection",new ia(this));S(this,"gridScrollZone",new aa(this));S(this,"currentRowId",Z(""));S(this,"currentColumnId",Z(""));S(this,"gridScrollingStatus",Z("is-scrolling-none"));S(this,"tableRootEl");S(this,"virtualListRef");S(this,"gridRowMap",{});S(this,"eventEmitter",new sa);S(this,"handleSelectionChange",(t,n,r)=>{const i=this.expandMergedSelectArea(n);let o={[t]:i};r&&(o={...this.interaction.selectBoxes,...o});const s={},l={};Object.keys(o).forEach(m=>{const{left:p,top:g,right:v,bottom:u}=o[m];for(let c=g;c<=u;c++)for(let h=p;h<=v;h++){const x=`${c}-${h}`;s[x]||(s[x]=new Set),c===g||c===u||h===p||h===v?(c===g&&h===p&&s[x].add("left-top"),c===g&&h===v&&s[x].add("right-top"),c===u&&h===p&&s[x].add("left-bottom"),c===u&&h===v&&s[x].add("right-bottom"),h>p&&h<v&&(c===g&&s[x].add("top"),c===u&&s[x].add("bottom")),c>g&&c<u&&(h===p&&s[x].add("left"),h===v&&s[x].add("right"))):s[x].add("center")}}),Object.keys(s).forEach(m=>{const p=s[m];p.has("left-top")&&p.has("right-bottom")||p.has("left-bottom")&&p.has("right-top")?l[m]=["left-top","right-bottom"]:l[m]=[...s[m]]});const a={},f=[],w=[],d=new Set;Object.keys(o).forEach(m=>{var h;const{left:p,top:g,right:v,bottom:u}=o[m],c=[];for(let x=g;x<=u;x++)for(let b=p;b<=v;b++){const M=`${x}-${b}`,L=(h=this.bodyMergeMap[x])==null?void 0:h[b],K=L==null?void 0:L.colspan,re=L==null?void 0:L.rowspan;if(a[M]=this.selectCellClassConstructor(l,x,b,re,K),!L||K||re){const ee={row:this.virtualListProps.list[x],rowIndex:x,column:this.flattedColumns[b],columnIndex:b};c.push(ee),d.has(M)||f.push(ee),d.add(M)}}w.push(c)}),Wt(this).onCellSelection({areas:w,cells:f}),this.interaction.selectBoxes=o,this.interaction.selectCellBorderMap=l,this.interaction.selectCellClassMap=a,this.forceUpdate()});this.gridSelection.on(this.handleSelectionChange)}forceUpdate(){this.watchData.renderKey+=1,console.log("forceUpdate")}setRowKey(t){this.rowKey=t,this.virtualListProps.itemKey=t}setRowMinHeight(t){this.virtualListProps.minSize=t}setColumns(t){const{leftFixedColumns:n,rightFixedColumns:r,centerNormalColumns:i,flattedColumns:o,headerCellInfo:s,originColumns:l,leftFixedHeaderColumns:a,rightFixedHeaderColumns:f,centerNormalHeaderColumns:w}=Bn(t);this.leftFixedColumns=n,this.rightFixedColumns=r,this.centerNormalColumns=i,this.flattedColumns=o,this.headerCellInfo=s,this.originColumns=l,this.leftFixedHeaderColumns=a,this.rightFixedHeaderColumns=f,this.centerNormalHeaderColumns=w,this.watchData.fullWidth=this.flattedColumns.reduce((d,y)=>d+y.width,0),this.forceUpdate()}setColumnWidth(t,n){const r=this.flattedColumns.find(i=>i._id===t);r&&(r.width=n,this.setColumns(this.originColumns))}setList(t){this.virtualListProps.list=t}setOriginList(t){this.originList=t}setTableRootEl(t){this.tableRootEl=t}generateFlatList(){const t=[],{foldMap:n,expandMap:r}=this.watchData,i=!!this.flattedColumns.find(f=>f.type===te.Expand),o=this.getUIProps("defaultExpandAll");this.gridRowMap={};let s=0,l=0;const a=(f,w=!1)=>{f.forEach((d,y)=>{var p;w&&(l+=1);const m={...d,level:s,groupLevel:l,isLastChild:y===f.length-1};t.push(m),this.gridRowMap[m.id]=m,d!=null&&d.children&&((p=d==null?void 0:d.children)==null?void 0:p.length)>0&&(s+=1,n[d.id]=!o,o&&a(d.children,d.type==="group"),s-=1),i&&(r[d.id]=o,o&&(this.gridRowMap[`${d.id}-expand`]={id:`${d.id}-expand`,type:"expand"})),r[d.id]&&t.push(this.gridRowMap[`${d.id}-expand`]),w&&(l-=1)})};return a(this.originList),this.setList(t),t}resetFlatList(){const t=[],{foldMap:n,expandMap:r}=this.watchData;let i=0,o=0;const s=(l,a=!1)=>{l.forEach((f,w)=>{var y;a&&(o+=1);const d={...f,level:i,groupLevel:o,isLastChild:w===l.length-1};t.push(d),this.gridRowMap[d.id]=d,n[f.id]===!1&&(f!=null&&f.children)&&((y=f==null?void 0:f.children)==null?void 0:y.length)>0&&(i+=1,s(f.children,f.type==="group"),i-=1),r[f.id]&&t.push(this.gridRowMap[`${f.id}-expand`]),a&&(o-=1)})};return s(this.originList),this.setList(t),t}mergeFunction(t,n){if(n===0)return t%2===0?{rowspan:2,colspan:1}:{rowspan:0,colspan:0}}mergeMapConstructorWithFunction(){const r=[];console.log(200,1e4);for(let i=0;i<200;i++)for(let o=0;o<1e4;o++){const s=this.mergeFunction(o,i);s&&r.push({rowIndex:o,colIndex:i,rowspan:s.rowspan,colspan:s.colspan})}return this.mergeMapConstructor(r)}mergeMapConstructor(t){const n={};return t.forEach(r=>{const{rowIndex:i,colIndex:o,rowspan:s,colspan:l}=r;n[i]?(n[i].$begin=Math.min(n[i].$begin,i),n[i].$end=Math.max(n[i].$end,i+s-1)):n[i]={$begin:i,$end:i+s-1};for(let a=i;a<i+s;a+=1)for(let f=o;f<o+l;f+=1)n[a]?(n[a].$begin=Math.min(n[a].$begin,i),n[a].$end=Math.max(n[a].$end,i+s-1)):n[a]={$begin:i,$end:i+s-1},n[a][f]={$begin:o,$end:o+l-1,mergeBy:[i,o]};n[i][o]={$begin:o,$end:o+l-1,rowspan:s,colspan:l}}),n}groupFoldConstructor(t,n){return this.constructGroup(t,0,n)}constructGroup(t,n,r){var w;if(n>=r.length)return t;const{columnId:i,sort:o}=r[n],s=t.sort((d,y)=>o==="desc"?y[i].localeCompare(d[i]):d[i].localeCompare(y[i])),l=[];let a=[];for(let d=0;d<s.length;d++){const y=s[d];y[i]===((w=a[a.length-1])==null?void 0:w[i])?a.push(y):(a.length&&l.push(a),a=[y])}a.length&&l.push(a);const f=[];return l.forEach(d=>{const y=d[0][i];f.push({id:`group-${i}-${Ae(4)}`,type:"group",columnId:i,name:y,children:this.constructGroup(d,n+1,r)})}),f}toggleFold(t){const{foldMap:n}=this.watchData;n[t]=!n[t],this.resetFlatList()}toggleExpand(t){const n=Wt(this),{expandMap:r}=this.watchData;r[t]=!r[t],r[t]&&!this.gridRowMap[`${t}-expand`]&&(this.gridRowMap[`${t}-expand`]={id:`${t}-expand`,type:"expand"});const i=Object.keys(r).filter(o=>!!r[o]).map(o=>this.gridRowMap[o]);n.onExpandChange({row:this.gridRowMap[t],expandedRows:i}),this.resetFlatList()}setUIProps(t,n){this.uiProps[t]=n}getUIProps(t){return this.uiProps[t]}expandMergedSelectArea(t){var f;const{left:n,top:r,right:i,bottom:o}=t,s={...t},l=new Set,a=[];for(let w=r;w<=o;w++)for(let d=n;d<=i;d++)a.push([w,d]);for(;a.length;){const[w,d]=a.shift(),y=(f=this.bodyMergeMap[w])==null?void 0:f[d],m=`${w}-${d}`;if(!l.has(m)&&(l.add(m),y)){const p=y.mergeBy;if(p){const h=this.bodyMergeMap[p[0]][p[1]];h&&(s.left=Math.min(s.left,p[1]),s.right=Math.max(s.right,p[1]+h.colspan-1),s.top=Math.min(s.top,p[0]),s.bottom=Math.max(s.bottom,p[0]+h.rowspan-1))}else{const{rowspan:h,colspan:x}=y;s.left=Math.min(s.left,d),s.right=Math.max(s.right,d+x-1),s.top=Math.min(s.top,w),s.bottom=Math.max(s.bottom,w+h-1)}const{left:g,top:v,right:u,bottom:c}=s;for(let h=v;h<=c;h++)for(let x=g;x<=u;x++)a.push([h,x])}}return s}selectCellClassConstructor(t,n,r,i=1,o=1){const s=`${n}-${r}`;let l=t[s];if(l){if(i>1||o>1){const a=new Set;for(let f=n;f<n+i;f++)for(let w=r;w<r+o;w++){const d=t[`${f}-${w}`];d&&d.forEach(y=>{a.add(y)})}a.has("left-top")&&(a.delete("left"),a.delete("top"),a.delete("center")),a.has("right-top")&&(a.delete("right"),a.delete("top"),a.delete("center")),a.has("left-bottom")&&(a.delete("left"),a.delete("bottom"),a.delete("center")),a.has("right-bottom")&&(a.delete("right"),a.delete("bottom"),a.delete("center")),(a.has("left")||a.has("right")||a.has("top")||a.has("bottom"))&&a.delete("center"),a.has("left-top")&&a.has("right-bottom")||a.has("left-bottom")&&a.has("right-top")?l=["left-top","right-bottom"]:l=[...a]}return["box-selection",...l.map(a=>`box-selection__${a}`)].join(" ")}return""}getSelectionClass(t,n){if(!this.getUIProps("selection"))return"";const r=n.colIndex,i=n.type;if(i===te.Expand||i===te.Index||i===te.Checkbox)return"kita-grid-cell--unselectable";const o=`${t}-${r}`;return this.interaction.selectCellClassMap[o]||""}initSelectionElement(t){this.gridSelection.init(t),this.gridScrollZone.init(t)}getCurrentRow(){return this.currentRowId.value}setCurrentRow(t){this.getUIProps("highlightCurrentRow")&&(this.currentRowId.value=t)}getCurrentColumn(){return this.currentColumnId.value}setCurrentColumn(t){this.getUIProps("highlightCurrentColumn")&&(this.currentColumnId.value=t)}setRowSelection(t=Ae(4),n,r,i){this.handleSelectionChange(t,{left:0,right:this.flattedColumns.length,top:n,bottom:r},i)}setColumnSelection(t=Ae(4),n,r,i){this.handleSelectionChange(t,{left:n,right:r,top:0,bottom:this.virtualListProps.list.length},i)}initVirtualListRef(t){this.virtualListRef=t}calcGridScrollingStatus(t,n,r){n<=r?this.gridScrollingStatus.value="is-scrolling-none":t===0?this.gridScrollingStatus.value="is-scrolling-left":t+r===n?this.gridScrollingStatus.value="is-scrolling-right":this.gridScrollingStatus.value="is-scrolling-middle"}}const da={},ca={class:"kita-grid-th-cell"};function fa(e,t){return C(),I("div",ca)}const ua=Yt(da,[["render",fa]]),ha={},pa={class:"kita-grid-th-cell"},ga=B("input",{type:"checkbox"},null,-1),va=[ga];function wa(e,t){return C(),I("div",pa,va)}const ma=Yt(ha,[["render",wa]]),ya={class:"kita-grid-th-cell"},ba=Y({__name:"TextHeaderCell",props:{column:{}},setup(e){return(t,n)=>(C(),I("div",ya,De(t.column.title),1))}}),xa="gird-column-resize-line",_a="gird-column-resize-trigger";function Xt(e){const n=getComputedStyle(e).getPropertyValue("position");(!n||n==="static")&&(e.style.position="relative")}function Ca(e){return!!e.__resizeTrigger}function Sa(e,t,n,r){if(Ca(e))return;const i=document.createElement("div");i.className=_a;const o={resizing:!1,startX:0,endX:0,columnLeft:0,columnCurrentWidth:0};function s(){return Vi(o.endX-o.startX+o.columnCurrentWidth,t.minWidth??0,t.maxWidth??1/0)}function l(){var d;if(!(t!=null&&t.resizable)){(d=i.parentElement)==null||d.removeChild(i);return}e&&!e.contains(i)&&(e.appendChild(i),Xt(e),getComputedStyle(e).getPropertyValue("border-right-width")==="0px"&&i.classList.add("is-opacity")),e.__resizeTrigger=!0}Jt(()=>l),ze(()=>[e,t],l,{immediate:!0});let a;function f(d){n&&(o.startX=d.clientX,o.columnLeft=n.scrollLeft+e.getBoundingClientRect().left-n.getBoundingClientRect().x-2,o.endX=d.clientX,o.columnCurrentWidth=e.getBoundingClientRect().width,a=document.createElement("div"),a.className=xa,n.appendChild(a),Xt(n),a.style.transform=`translateX(${s()+o.columnLeft}px)`,a.style.top=`${n.scrollTop}px`)}function w(d){o.resizing&&(d.preventDefault(),o.endX=d.clientX,a&&(a.style.transform=`translateX(${s()+o.columnLeft}px)`))}i.addEventListener("mouseenter",d=>{a||f(d)}),i.addEventListener("mouseleave",d=>{!o.resizing&&a&&(a.remove(),a=void 0)}),i.addEventListener("mousedown",d=>{d.preventDefault(),!o.resizing&&(o.resizing=!0,document.addEventListener("mousemove",w),document.addEventListener("mouseup",()=>{o.resizing=!1,document.removeEventListener("mousemove",w),a==null||a.remove(),a=void 0,console.log(s()),r(s())},{once:!0}))})}const $a=["data-id","rowspan","colspan"],Ta=["colspan"],Ia=["data-id","rowspan","colspan"],La=["colspan"],Ea=["data-id","rowspan","colspan"],Pa=Y({__name:"GridHeaderRow",props:{headerRowIndex:{},currentColumn:{},centerColumnsInfo:{}},setup(e){const t=me("gridStore"),{headerCellInfo:n,leftFixedHeaderColumns:r,rightFixedHeaderColumns:i,centerNormalHeaderColumns:o}=t,s={leftFixed:(u,c)=>["kita-grid-th","is-fixed","is-fixed--left",c===r[l.headerRowIndex].length-1&&"is-last-column",m(u),u.className],leftPadding:()=>["kita-grid-th"],main:u=>["kita-grid-th",m(u),u.className],rightPadding:()=>["kita-grid-th"],rightFixed:(u,c)=>["kita-grid-th","is-fixed","is-fixed--right",c===0&&"is-first-column",m(u),u.className],row:()=>["kita-grid-tr",d()]},l=e,a=W(()=>{var h;const u=l.centerColumnsInfo[l.headerRowIndex],c=u==null?void 0:u[0];return((h=n[c==null?void 0:c._id])==null?void 0:h.leftColspan)??0}),f=W(()=>{var L,K;const u=l.centerColumnsInfo[l.headerRowIndex],c=u==null?void 0:u[(u==null?void 0:u.length)-1],h=((L=n[c==null?void 0:c._id])==null?void 0:L.leftColspan)??0,x=o[l.headerRowIndex],b=x==null?void 0:x[(x==null?void 0:x.length)-1];return(((K=n[b==null?void 0:b._id])==null?void 0:K.leftColspan)??0)-h}),w=r[l.headerRowIndex].concat(o[l.headerRowIndex],i[l.headerRowIndex]),d=()=>{const u=t.getUIProps("headerRowClassName");if(u)return u({row:w,rowIndex:l.headerRowIndex})},y=()=>{const u=t.getUIProps("headerRowStyle");if(u)return u({row:w,rowIndex:l.headerRowIndex})},m=u=>{const c=t.getUIProps("headerCellClassName");if(c)return c({row:l.currentColumn,rowIndex:l.headerRowIndex,column:u,columnIndex:u.colIndex})},p=u=>{const c=t.getUIProps("headerCellStyle");if(c)return c({row:l.currentColumn,rowIndex:l.headerRowIndex,column:u,columnIndex:u.colIndex})},g=Z();Jt(()=>{var u;(u=g.value)==null||u.querySelectorAll(":scope>th[data-id]").forEach(c=>{var x,b;const h=c.getAttribute("data-id");!h||!((x=n[h])!=null&&x.resizable)||!((b=n[h])!=null&&b.isLeaf)||Sa(c,n[h],t.tableRootEl,M=>{h&&t.setColumnWidth(h,M)})})});function v(u){var c;switch(u.type){case te.Index:return ua;case te.Checkbox:return ma;default:return u!=null&&u.headerRender?(c=u==null?void 0:u.headerRender)==null?void 0:c.call(u,u):ba}}return(u,c)=>(C(),I("tr",{ref_key:"itemRefEl",ref:g,class:N(s.row()),style:G(y())},[(C(!0),I(V,null,q($(r)[u.headerRowIndex],(h,x)=>{var b,M;return C(),I("th",{key:h.field,"data-id":h._id,class:N(s.leftFixed(h,x)),style:G(`text-align: ${h.headerAlign||h.align}; left: ${$(n)[h._id].left}px; ${p(h)}`),rowspan:(b=$(n)[h._id])==null?void 0:b.rowspan,colspan:(M=$(n)[h._id])==null?void 0:M.colspan},[(C(),Q(oe(v(h)),{column:h},null,8,["column"]))],14,$a)}),128)),a.value>0?(C(),I("th",{key:0,class:N(s.leftPadding()),colspan:a.value},null,10,Ta)):ge("",!0),(C(!0),I(V,null,q(u.centerColumnsInfo[u.headerRowIndex],h=>{var x,b;return C(),I("th",{key:h.field,class:N(s.main(h)),style:G(`text-align: ${h.headerAlign||h.align}; ${p(h)}`),"data-id":h._id,rowspan:(x=$(n)[h._id])==null?void 0:x.rowspan,colspan:(b=$(n)[h._id])==null?void 0:b.colspan},[(C(),Q(oe(v(h)),{column:h},null,8,["column"]))],14,Ia)}),128)),f.value>0?(C(),I("th",{key:1,class:N(s.rightPadding),colspan:f.value},null,10,La)):ge("",!0),(C(!0),I(V,null,q($(i)[u.headerRowIndex],(h,x)=>{var b,M;return C(),I("th",{key:h.field,"data-id":h._id,class:N(s.rightFixed(h,x)),style:G(`text-align: ${h.headerAlign||h.align}; right: ${$(n)[h._id].right}px; ${p(h)}`),rowspan:(b=$(n)[h._id])==null?void 0:b.rowspan,colspan:(M=$(n)[h._id])==null?void 0:M.colspan},[(C(),Q(oe(v(h)),{column:h},null,8,["column"]))],14,Ea)}),128))],6))}}),Aa=Y({__name:"GridHeader",setup(e){const t=me("gridStore"),{leftFixedHeaderColumns:n}=t,r=W(()=>{const{centerNormalColumns:i,centerNormalHeaderColumns:o,headerCellInfo:s}=t,l=[];i.forEach(w=>{s[w._id].rendered=!1;const{parentColumn:d}=s[w._id];d&&(s[d._id].rendered=!1)});for(let w=t.watchData.colRenderBegin;w<=t.watchData.colRenderEnd;w++){const d=i[w],{level:y=0,parentColumn:m}=s[d._id];if(l[y]===void 0&&(l[y]=[]),l[y].push(d),s[d._id].rendered=!0,m){const{level:p=0}=s[m._id];l[p]===void 0&&(l[p]=[]),l[p].indexOf(m)<0&&(l[p].push(m),s[m._id].rendered=!0)}}const a=[],f=o.length;for(let w=0;w<f;w++)a.push(0);for(let w=0;w<f;w++){const d=o[w];for(let y=0;y<d.length;y++){const m=s[d[y]._id],p=m.parentId?s[m.parentId]:void 0;if(!m.rendered&&(!p||p.rendered))for(let g=w;g<f;g++)a[g]+=m.colspan||1;else break}}for(let w=0;w<f;w++){const d=o[w];let y=!0;for(let m=0;m<d.length;m++){const p=s[d[m]._id];(p.rendered||!y)&&(p.leftColspan=a[w],a[w]+=p.colspan||1,y=!1)}}return l});return(i,o)=>(C(!0),I(V,null,q($(n),(s,l)=>(C(),Q(Pa,{key:l,currentColumn:s,headerRowIndex:l,centerColumnsInfo:r.value},null,8,["currentColumn","headerRowIndex","centerColumnsInfo"]))),128))}}),$n=Y({__name:"Placement",props:{showLine:{type:Boolean,default:!1},isLastPlacement:{type:Boolean,default:!1},isLastChild:{type:Boolean,default:!1}},setup(e){const t=e,n=W(()=>["placement",t.showLine&&"placement--tree-line",t.showLine&&t.isLastPlacement&&"placement--last-padding",t.showLine&&t.isLastPlacement&&t.isLastChild&&"placement--last-tree-node"]);return(r,i)=>(C(),I("div",{class:N(n.value)},null,2))}}),Ra=B("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[B("path",{d:"M8.58816 5.15502L16.888 11.1913C17.4371 11.5906 17.4371 12.4094 16.888 12.8087L8.58816 18.845C7.92719 19.3257 6.99999 18.8535 6.99999 18.0362L6.99999 5.96376C6.99999 5.14647 7.92719 4.67432 8.58816 5.15502Z",fill:"#6B7075"})],-1),za=[Ra],Oa={class:"content"},Ma=Y({__name:"TitleCell",props:{row:{},column:{}},setup(e){const t=me("gridStore"),{watchData:n}=t,r=e,i=W(()=>t.getUIProps("showTreeLine")),o=W(()=>{var s,l;return(l=(s=r.column)==null?void 0:s.bodyRender)==null?void 0:l.call(s,r.column,r.row)});return(s,l)=>(C(),I("div",{class:"kita-grid-cell kita-grid-cell__title",style:G(`width: ${s.column.width}px;`)},[(C(!0),I(V,null,q(s.row.level,a=>(C(),Q($n,{key:a,"show-line":i.value&&a>s.row.groupLevel,"is-last-child":s.row.isLastChild,"is-last-placement":a===s.row.level},null,8,["show-line","is-last-child","is-last-placement"]))),128)),B("div",{class:N(["tree-leading",i.value?"tree-leading--tree-line":"tree-leading--tree-line-hide",(!s.row.level||s.row.level===s.row.groupLevel)&&"tree-leading--first-node"])},[$(n).foldMap[s.row.id]!==void 0?(C(),I("div",{key:0,class:N(["tree-leading-icon",!$(n).foldMap[r.row.id]&&"tree-leading-icon--expand"]),onClick:l[0]||(l[0]=Qt(a=>$(t).toggleFold(s.row.id),["stop"]))},za,2)):ge("",!0)],2),B("div",Oa,[o.value?(C(),Q(oe(o.value),{key:0})):(C(),I(V,{key:1},[Rn(De(s.column.field?s.row[s.column.field]:""),1)],64))])],4))}}),ka={class:"kita-grid-cell kita-grid-cell__text"},ja=Y({__name:"TextCell",props:{rowIndex:{},row:{},column:{}},setup(e){return(t,n)=>(C(),I("div",ka,De(t.column.field?t.row[t.column.field]:""),1))}});function qt({currentRowMergeInfo:e,columns:t,startIndex:n,endIndex:r,offsetIndex:i=0}){var s,l,a,f;const o=[];for(let w=n;w<=r;w++){const d=t[w];(e==null?void 0:e[w+i])===void 0?o.push(d):((s=e==null?void 0:e[w+i])==null?void 0:s.colspan)!==void 0&&(o.push({...d,colspan:(l=e==null?void 0:e[w+i])==null?void 0:l.colspan,rowspan:(a=e==null?void 0:e[w+i])==null?void 0:a.rowspan}),w+=(((f=e==null?void 0:e[w+i])==null?void 0:f.colspan)??0)-1)}return o}const Da=(e,t)=>W(()=>{var x,b,M,L,K,re,ee,le;const{watchData:r,bodyMergeMap:i,leftFixedColumns:o,rightFixedColumns:s,centerNormalColumns:l}=t,a=i[e],f=o.length,w=f+l.length,d=qt({currentRowMergeInfo:a,columns:o,startIndex:0,endIndex:o.length-1,offsetIndex:0}),y=qt({currentRowMergeInfo:a,columns:s,startIndex:0,endIndex:s.length-1,offsetIndex:w}),m=r.colRenderBegin+f,g=(((x=a==null?void 0:a[m])==null?void 0:x.$begin)!==void 0?(b=a==null?void 0:a[m])==null?void 0:b.$begin:m)-f,v=r.colRenderEnd+f,u=((M=a==null?void 0:a[v])==null?void 0:M.$end)!==void 0?(L=a==null?void 0:a[v])==null?void 0:L.$end:v,c=Math.max(0,l.length-1-u+f),h=[];for(let H=g;H<=r.colRenderEnd;H++)(a==null?void 0:a[H+f])===void 0?h.push(l[H]):((K=a==null?void 0:a[H+f])==null?void 0:K.colspan)!==void 0&&(h.push({...l[H],colspan:(re=a==null?void 0:a[H+f])==null?void 0:re.colspan,rowspan:(ee=a==null?void 0:a[H+f])==null?void 0:ee.rowspan}),H+=(((le=a==null?void 0:a[H+f])==null?void 0:le.colspan)??1)-1);return{leftColumns:d,rightColumns:y,centerColumns:h,leftCount:g,rightCount:c}}),Ba={class:"kita-grid-cell kita-grid-cell__index"},Fa=Y({__name:"IndexCell",props:{rowIndex:{},row:{},column:{}},setup(e){var r,i;const t=e,n=((i=(r=t.column)==null?void 0:r.index)==null?void 0:i.call(r,t.rowIndex))??t.rowIndex+1;return(o,s)=>(C(),I("div",Ba,De($(n)),1))}}),Ua={class:"kita-grid-cell kita-grid-cell__checkbox"},Na=B("input",{type:"checkbox"},null,-1),Ha=[Na],Ka=Y({__name:"CheckboxCell",props:{rowIndex:{},row:{},column:{}},setup(e){return(t,n)=>(C(),I("div",Ua,Ha))}}),Ga=B("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none"},[B("path",{d:"M6.79289 22.2071C6.40237 21.8166 6.40237 21.1834 6.79289 20.7929L15.0858 12.5L6.79289 4.20711C6.40237 3.81658 6.40237 3.18342 6.79289 2.79289C7.18342 2.40237 7.81658 2.40237 8.20711 2.79289L17.2071 11.7929C17.5976 12.1834 17.5976 12.8166 17.2071 13.2071L8.20711 22.2071C7.81658 22.5976 7.18342 22.5976 6.79289 22.2071Z",fill:"#6B7075"})],-1),Za=[Ga],Va=Y({__name:"ExpandCell",props:{rowIndex:{},row:{},column:{}},setup(e){const t=me("gridStore"),{watchData:n}=t;return(r,i)=>(C(),I("div",{class:"kita-grid-cell kita-grid-cell__expand",onClick:i[0]||(i[0]=o=>$(t).toggleExpand(r.row.id))},[B("div",{class:N(["row-expand-icon",$(n).expandMap[r.row.id]&&"row-expand-icon--expand"])},Za,2)]))}}),Wa=["rowspan","colspan","data-rowidx","data-colidx"],Xa=["colspan"],qa=["rowspan","colspan","data-rowidx","data-colidx"],Ya=["colspan"],Ja=["rowspan","colspan","data-rowidx","data-colidx"],Qa=Y({__name:"BaseRow",props:{resizeObserver:{default:null},rowIndex:{default:0},row:{}},setup(e){const t=me("gridStore"),{headerCellInfo:n}=t,r=e,i=W(()=>t.getCurrentRow()),o=W(()=>t.getCurrentColumn()),s={leftFixed:(v,u)=>["kita-grid-td","is-fixed","is-fixed--left",u===a.value.leftColumns.length-1&&"is-last-column",v._id===o.value&&"current-column",t.getSelectionClass(r.rowIndex,v),d(v),v.className],leftPadding:()=>["kita-grid-td"],main:v=>["kita-grid-td",v._id===o.value&&"current-column",t.getSelectionClass(r.rowIndex,v),d(v),v.className],rightPadding:()=>["kita-grid-td"],rightFixed:(v,u)=>["kita-grid-td","is-fixed","is-fixed--right",u===0&&"is-first-column",v._id===o.value&&"current-column",t.getSelectionClass(r.rowIndex,v),d(v),v.className],row:()=>["kita-grid-tr",t.getUIProps("stripe")&&r.rowIndex%2&&"kita-grid-tr--striped",r.row.id===i.value&&"current-row",w()]},{itemRefEl:l}=dt({resizeObserver:r.resizeObserver}),a=Da(r.rowIndex,t),f=W(()=>t.watchData.rowHeightMap.get(String(r.row.id))),w=()=>{const v=t.getUIProps("rowClassName");if(v)return v({row:r.row,rowIndex:r.rowIndex})},d=v=>{const u=t.getUIProps("cellClassName");if(u)return u({row:r.row,rowIndex:r.rowIndex,column:v,columnIndex:v.colIndex})},y=()=>{const v=t.getUIProps("rowStyle");if(v)return v({row:r.row,rowIndex:r.rowIndex})},m=v=>{const u=t.getUIProps("cellStyle");if(u)return u({row:r.row,rowIndex:r.rowIndex,column:v,columnIndex:v.colIndex})};function p(v){var u;switch(v.type){case te.Index:return Fa;case te.Title:return Ma;case te.Checkbox:return Ka;case te.Expand:return Va;default:return v.bodyRender?(u=v==null?void 0:v.bodyRender)==null?void 0:u.call(v,v,r.row):ja}}function g(){t.setCurrentRow(r.row.id)}return(v,u)=>(C(),I("tr",{ref_key:"itemRefEl",ref:l,class:N(s.row()),style:G(y()),onMousedown:g},[(C(!0),I(V,null,q($(a).leftColumns,(c,h)=>(C(),I("td",{key:c.field,class:N(s.leftFixed(c,h)),style:G(`text-align: ${c.align}; left: ${$(n)[c._id].left}px; ${m(c)}`),rowspan:c==null?void 0:c.rowspan,colspan:c==null?void 0:c.colspan,"data-rowidx":v.rowIndex,"data-colidx":c.colIndex},[(C(),Q(oe(p(c)),{rowIndex:v.rowIndex,row:v.row,column:c},null,8,["rowIndex","row","column"]))],14,Wa))),128)),$(a).leftCount>0?(C(),I("td",{key:0,class:N(s.leftPadding()),colspan:$(a).leftCount,style:G(`height: ${f.value}px`)},null,14,Xa)):ge("",!0),(C(!0),I(V,null,q($(a).centerColumns,c=>(C(),I("td",{key:c.field,class:N(s.main(c)),style:G(`text-align: ${c.align}; ${m(c)}`),rowspan:c==null?void 0:c.rowspan,colspan:c==null?void 0:c.colspan,"data-rowidx":v.rowIndex,"data-colidx":c.colIndex},[(C(),Q(oe(p(c)),{rowIndex:v.rowIndex,row:v.row,column:c},null,8,["rowIndex","row","column"]))],14,qa))),128)),$(a).rightCount>0?(C(),I("td",{key:1,class:N(s.rightPadding),colspan:$(a).rightCount,style:G(`height: ${f.value}px`)},null,14,Ya)):ge("",!0),(C(!0),I(V,null,q($(a).rightColumns,(c,h)=>(C(),I("td",{key:c.field,class:N(s.rightFixed(c,h)),style:G(`text-align: ${c.align}; right: ${$(n)[c._id].right}px; ${m(c)}`),rowspan:c==null?void 0:c.rowspan,colspan:c==null?void 0:c.colspan,"data-rowidx":v.rowIndex,"data-colidx":c.colIndex},[(C(),Q(oe(p(c)),{rowIndex:v.rowIndex,row:v.row,column:c},null,8,["rowIndex","row","column"]))],14,Ja))),128))],38))}}),el=["colspan"],tl=B("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[B("path",{d:"M8.58816 5.15502L16.888 11.1913C17.4371 11.5906 17.4371 12.4094 16.888 12.8087L8.58816 18.845C7.92719 19.3257 6.99999 18.8535 6.99999 18.0362L6.99999 5.96376C6.99999 5.14647 7.92719 4.67432 8.58816 5.15502Z",fill:"#6B7075"})],-1),nl=[tl],rl=Y({__name:"GroupRow",props:{row:{},resizeObserver:{default:null},rowIndex:{default:0}},setup(e){const t=me("gridStore"),{foldMap:n,config:r}=t.watchData,{flattedColumns:i}=t,o=e;console.log(111,n[o.row.id]);const{itemRefEl:s}=dt({resizeObserver:o.resizeObserver});return(l,a)=>(C(),I("tr",{ref_key:"itemRefEl",ref:s,class:"kita-grid-tr kita-grid-tr--group"},[B("td",{class:"kita-grid-td kita-grid-td--group",colspan:$(i).length},[B("div",{class:"kita-grid-cell",style:G(`height: ${$(r).rowHeight}px;`)},[(C(!0),I(V,null,q(o.row.level,f=>(C(),Q($n,{key:f,class:N(f===o.row.level?"last":"")},null,8,["class"]))),128)),B("div",{class:N(["group-icon",!$(n)[o.row.id]&&"group-icon--expand"]),onClick:a[0]||(a[0]=Qt(f=>$(t).toggleFold(l.row.id),["stop"]))},nl,2),B("div",null,"分组-"+De(o.row.name),1)],4)],8,el)],512))}}),il=["colspan"],ol={class:"kita-grid-cell"},sl=Y({__name:"ExpandRow",props:{resizeObserver:{default:null},rowIndex:{},row:{}},setup(e){const t=me("gridStore"),{flattedColumns:n}=t,r=W(()=>n.find(l=>l.type==="expand")),i=e,{itemRefEl:o}=dt({resizeObserver:i.resizeObserver}),s=l=>{var a,f;return(f=(a=r.value)==null?void 0:a.bodyRender)==null?void 0:f.call(a,r.value,l)};return(l,a)=>(C(),I("tr",{ref_key:"itemRefEl",ref:o,class:"kita-grid-tr"},[B("td",{class:"kita-grid-td kita-grid-td--expand",colspan:$(n).length},[B("div",ol,[(C(),Q(oe(s(l.row))))])],8,il)],512))}}),al=["width"],ll=["width"],dl=["width"],cl={class:"kita-grid-body"},fl={key:0,class:"kita-grid-mask"},ul=B("p",null,"No Data",-1),gl=Y({__name:"Grid",props:{columns:{default:()=>[]},list:{default:()=>[]},rowKey:{default:"id"},rowMinHeight:{default:30},showHeader:{type:Boolean,default:!0},defaultExpandAll:{type:Boolean,default:!1},border:{type:Boolean,default:!1},stripe:{type:Boolean,default:!1},showTreeLine:{type:Boolean,default:!1},selection:{type:Boolean,default:!1},highlightCurrentRow:{type:Boolean,default:!1},highlightCurrentColumn:{type:Boolean,default:!1},merges:{default:()=>[]},groupConfig:{default:()=>[]},headerRowClassName:{type:Function,default:()=>""},headerRowStyle:{type:Function,default:()=>""},headerCellClassName:{type:Function,default:()=>""},headerCellStyle:{type:Function,default:()=>""},rowClassName:{type:Function,default:()=>""},rowStyle:{type:Function,default:()=>""},cellClassName:{type:Function,default:()=>""},cellStyle:{type:Function,default:()=>""}},setup(e,{emit:t}){const n=t,r=e,i=new la;Mn("gridStore",i),i.setUIProps("border",r.border),i.setUIProps("stripe",r.stripe),i.setUIProps("showTreeLine",r.showTreeLine),i.setUIProps("selection",r.selection),i.setUIProps("highlightCurrentRow",r.highlightCurrentRow),i.setUIProps("highlightCurrentColumn",r.highlightCurrentColumn),i.setUIProps("defaultExpandAll",r.defaultExpandAll),i.setUIProps("headerRowClassName",r.headerRowClassName),i.setUIProps("headerRowStyle",r.headerRowStyle),i.setUIProps("headerCellClassName",r.headerCellClassName),i.setUIProps("headerCellStyle",r.headerCellStyle),i.setUIProps("rowClassName",r.rowClassName),i.setUIProps("rowStyle",r.rowStyle),i.setUIProps("cellClassName",r.cellClassName),i.setUIProps("cellStyle",r.cellStyle),i.setColumns(r.columns),r.merges&&(i.bodyMergeMap=i.mergeMapConstructor(r.merges)),r.rowKey&&i.setRowKey(r.rowKey),r.rowMinHeight&&i.setRowMinHeight(r.rowMinHeight);let o=r.list;r.groupConfig&&r.groupConfig.length&&(o=i.groupFoldConstructor(o,r.groupConfig));function s(z){i.setList([]),setTimeout(()=>{i.setOriginList(z),i.generateFlatList()})}ze(()=>r.groupConfig,z=>{if(z!=null&&z.length){const D=i.groupFoldConstructor(r.list,z);s(D)}}),ze(()=>r.list,z=>{s(z)},{immediate:!0});const{centerNormalColumns:l,leftFixedColumns:a,rightFixedColumns:f}=i;function w(z,D){let A=0,J=0,he=0,Se=!1;for(let de=0;de<l.length;de++){const We=l[de].width;if(he>=z&&!Se)A=de,Se=!0;else if(he>=z+D){J=de;break}J=de,he+=We}A=Math.max(0,A-1),J=Math.min(l.length-1,J+1),i.watchData.colRenderBegin=A,i.watchData.colRenderEnd=J}function d(z,D,A){i.calcGridScrollingStatus(z,D,A)}const y={scroll:z=>{const{scrollLeft:D,scrollWidth:A,clientWidth:J}=z.target;w(D,J),d(D,A,J)},toTop:()=>{},toBottom:()=>{},itemResize:(z,D)=>{const A=i.watchData.rowHeightMap.get(String(z))??r.rowMinHeight;i.watchData.rowHeightMap.set(String(z),Math.max(A,D))}},m=jn(i.virtualListProps,y);i.initVirtualListRef(m);const{resizeObserver:p,reactiveData:g,slotSize:v,renderList:u,clientRefEl:c,stickyHeaderRefEl:h}=m,x=Z(),b=Z(),{onClick:M,onDblclick:L,onContextmenu:K}=oa(i);function re(z){switch(z.type){case"group":return rl;case"expand":return sl;default:return Qa}}const ee=W(()=>({body:[i.getUIProps("border")&&"kita-grid-main--border"],table:["kita-grid-table",i.gridScrollingStatus.value]})),le=W(()=>i.watchData.fullWidth),H=W(()=>v.stickyHeaderSize);return at(()=>{if(c.value){const{scrollLeft:z,scrollWidth:D,clientWidth:A}=c.value;w(z,A),d(z,D,A)}x.value&&i.setTableRootEl(x.value),b.value&&i.initSelectionElement(b.value);for(const z of Object.values({...Le,...Ee,...Pe,...Ue}))i.eventEmitter.on(z,D=>{n(z,D)})}),lt(()=>{i.eventEmitter.offAll()}),(z,D)=>(C(),I("div",{class:"kita-grid-root",ref_key:"rootRefEl",ref:b},[B("div",{class:N(["kita-grid-main",ee.value.body]),ref_key:"clientRefEl",ref:c,"data-id":"client"},[B("div",{style:G(`float:left; height: ${$(g).listTotalSize}px`)},null,4),B("table",{class:N(ee.value.table),cellspacing:"0",cellpadding:"0",style:G(`width: ${le.value}px;`),ref_key:"tableRefEl",ref:x,onClick:D[0]||(D[0]=(...A)=>$(M)&&$(M)(...A)),onDblclick:D[1]||(D[1]=(...A)=>$(L)&&$(L)(...A)),onContextmenu:D[2]||(D[2]=(...A)=>$(K)&&$(K)(...A))},[(C(),I("colgroup",{key:$(i).watchData.renderKey},[(C(!0),I(V,null,q($(a),A=>(C(),I("col",{key:A._id,width:A.width},null,8,al))),128)),(C(!0),I(V,null,q($(l),A=>(C(),I("col",{key:A._id,width:A.width},null,8,ll))),128)),(C(!0),I(V,null,q($(f),A=>(C(),I("col",{key:A._id,width:A.width},null,8,dl))),128))])),r.showHeader?(C(),I("thead",{key:0,ref_key:"stickyHeaderRefEl",ref:h,"data-id":"stickyHeader",class:"kita-grid-header",style:G(`height: ${H.value}px;`)},[zn(Aa)],4)):ge("",!0),B("tbody",cl,[B("tr",{style:G(`height: ${$(g).virtualSize}px;`)},null,4),(C(!0),I(V,null,q($(u),(A,J)=>(C(),Q(oe(re(A)),{key:A.id,resizeObserver:$(p),row:A,rowIndex:J+$(g).renderBegin,"data-id":A.id,"data-level":A.level},null,8,["resizeObserver","row","rowIndex","data-id","data-level"]))),128))])],38)],2),$(o).length?ge("",!0):(C(),I("div",fl,[On(z.$slots,"empty",{},()=>[ul])]))],512))}});export{te as C,gl as _};
